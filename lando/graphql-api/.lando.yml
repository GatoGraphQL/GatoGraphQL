name: graphql-api-dev
recipe: wordpress
config:
  webroot: .
  php: '7.4'
  ssl: true
  database: mariadb
  ########################################
  # Debugging: uncomment this configuration
  # --------------------------------------
  # xdebug: true
  # config:
  #   php: config/php.ini
  ########################################
  
services:
  database:
    portforward: true
  appserver:
    overrides:
      volumes:
        - ../../layers/GraphQLAPIForWP/plugins/graphql-api-for-wp:/app/wp-content/plugins/graphql-api
            
    build:
      - wp core download --force --skip-content

    run:
      - cd /app/wp-content/plugins/graphql-api && composer install
      - cd /app
      - wp config create --dbname=wordpress --dbuser=wordpress --dbpass=wordpress --dbhost=database --skip-check --force
      - wp core install --url=graphql-api-dev.lndo.site --title="GraphQL API" --admin_user=admin --admin_password=admin --admin_email=admin@example.com
      - cp assets/.htaccess .
      # - perl -p -i -e "s/\/\* That's all, stop editing! Happy publishing. \*\//\ndefine('JWT_AUTH_SECRET_KEY', 'bite-me');\n\/\* That's all, stop editing! Happy publishing. \*\//" wordpress/wp-config.php
      # - wp theme install twentytwentyone --activate
      # - wp post delete 1
      - wp rewrite structure '/%postname%/' --hard
      # - wp plugin install classic-editor --activate
      # - wp plugin install jwt-auth --activate
      # - wp plugin install wordpress-importer --activate
      # - wp plugin install wordpress-seo --activate
      # - wp plugin install powerpress --activate
      - wp plugin activate graphql-api
      # - wp import assets/voicesoftheelephpant.wordpress.2020-07-23.000.xml --authors=create
      # - wp user update calevans --rich_editing=false
      # - wp user update admin --rich_editing=false
