name: InstaWP temp test - Integration tests
on:
    push:
        branches:
            - master
    # pull_request: null
env:
    CHECKOUT_SUBMODULES: ""

jobs:
    main:
        name: InstaWP temp test
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v3
                with:
                    submodules: ${{ env.CHECKOUT_SUBMODULES }}

            -   uses: shivammathur/setup-php@v2
                with:
                    php-version: 8.1
                    coverage: none
                env:
                    COMPOSER_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            -   uses: "ramsey/composer-install@v2"

            -   name: Run tests
                # Temporary test of InstaWP with hardcoded site. Remove!
                # run: INTEGRATION_TESTS_WEBSERVER_DOMAIN=awning-yak-duxu.instawp.xyz INTEGRATION_TESTS_AUTHENTICATED_ADMIN_USER_USERNAME=instawp_admin INTEGRATION_TESTS_AUTHENTICATED_ADMIN_USER_PASSWORD=VlmclfuHbdgntgobxkvboXUoqZM2Ie5y vendor/bin/phpunit --filter='Integration'
                run: |
                    INTEGRATION_TESTS_WEBSERVER_DOMAIN=awning-yak-duxu.instawp.xyz \
                    INTEGRATION_TESTS_AUTHENTICATED_ADMIN_USER_USERNAME=${{ secrets.INSTAWP_ADMIN_USER_USERNAME }} \
                    INTEGRATION_TESTS_AUTHENTICATED_ADMIN_USER_PASSWORD=${{ secrets.INSTAWP_ADMIN_USER_PASSWORD }} \
                    vendor/bin/phpunit --filter=Integration
