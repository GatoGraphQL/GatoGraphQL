"use strict";!function(e){window.popFullCalendar={calendar:function(a){var t=this,n=a.domain,r=a.pageSection,o=a.block,l=a.targets,i=popManager.getPageSectionPage(o);i.one("destroy",function(){l.fullCalendar("destroy")}),i.hasClass("tab-pane")&&!popManager.isActive(i)&&i.one("shown.bs.tabpane",function(){l.fullCalendar("render")}),o.on("beforeRender",function(a,t){var n=e(this);t.operation==M.URLPARAM_OPERATION_REPLACE&&popFullCalendarMemory.resetBlockRuntimeMemory(r,n)}),o.on("addedEvents",function(){t.execCalendar(n,r,o,l,"update"),windowResize()}),t.execCalendar(n,r,o,l,"new")},execCalendar:function(a,t,n,r,o){var l,i=this,u=popFullCalendarMemory.getRuntimeMemoryPage(t,n),c=i.getDate(t,n);"new"==o&&(l={header:{left:"title",center:"",right:""},events:function(e,a,t,n){n(u.events)},defaultDate:c,fixedWeekCount:!1,height:"auto",contentHeight:"auto",dayNamesShort:M.DATERANGE_DAYSOFWEEK}),r.each(function(){var r=e(this);i.execFullCalendar(a,t,n,r,o,l)}),i.setDateLoaded(t,n,c)},execFullCalendar:function(a,t,n,r,o,l){var i=this;if("new"==o){var u=popManager.getJsSettings(a,t,n,r),c=u.options||{},d=e.extend({},l,c),s=u.layouts;d.eventRender=function(e,a){i.renderEvent(t,n,s,e,a)},d.eventAfterAllRender=function(e){i.renderEventAfterAll(t,n,s)},r.fullCalendar(d)}else"update"==o&&r.fullCalendar("refetchEvents")},setDateLoaded:function(e,a,t){popFullCalendarMemory.getRuntimeMemoryPage(e,a).loadedDates[t.year()+"-"+(t.month()+1)]=!0},isDateLoaded:function(e,a,t){return!0===popFullCalendarMemory.getRuntimeMemoryPage(e,a).loadedDates[t.year()+"-"+(t.month()+1)]},getDate:function(e,a){var t=popManager.getBlockQueryState(e,a),n=parseInt(t[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]),r=parseInt(t[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]);return moment(n+"-"+r+"-01","YYYY-M-DD")},renderEvent:function(a,t,n,r,o){var l=popFullCalendarMemory.getRuntimeMemoryPage(a,t),i=r.domain,u=r.id;l.eventsHtml[i]=l.eventsHtml[i]||{};var c=l.eventsHtml[i][u];if(c)l.runJS=!0;else{var d={},s=popManager.getDatabaseKeys(i,a,t)["db-key"];c="",popJSRuntimeManager.setBlockURL(t),e.each(n,function(e,n){c+=popManager.getTemplateHtml(i,a,t,n,d,s,u)}),l.eventsHtml[i][u]=c}o.html(c)},renderEventAfterAll:function(a,t,n){var r=popFullCalendarMemory.getRuntimeMemoryPage(a,t);if(popManager.triggerHTMLMerged(),r.runJS){r.runJS=!1;var o=popManager.getQueryMultiDomainUrls(a,t);e.each(o,function(r,o){e.each(n,function(e,n){popManager.runJSMethods(r,a,t,n,"full")})})}},fetch:function(e,a,t){var n=this,r=n.getDate(e,a);t.fullCalendar("gotoDate",r),n.isDateLoaded(e,a,r)||popManager.fetchBlock(e,a,{operation:M.URLPARAM_OPERATION_APPEND})}}}(jQuery),function(e){window.popFullCalendarControls={controlCalendarPrev:function(a){var t=this,n=a.pageSection,r=a.block;a.targets.click(function(a){var o=e(this);t.execute(n,r,o,"prev")})},controlCalendarNext:function(a){var t=this,n=a.pageSection,r=a.block;a.targets.click(function(a){var o=e(this);t.execute(n,r,o,"next")})},setCalendarBlockParams:function(e,a,t){var n=popManager.getBlockQueryState(e,a);n[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_YEAR]=t.year(),n[M.DATALOAD_VISIBLEPARAMS][M.URLPARAM_MONTH]=t.month()+1},execute:function(a,t,n,r){var o=this,l=e(n.closest(".pop-calendar-controls").data("target")),i=l.fullCalendar("getDate");"next"==r?i.add(1,"months"):i=i.subtract(1,"months"),o.setCalendarBlockParams(a,t,i),popManager.closeMessageFeedback(t),popFullCalendar.fetch(a,t,l)}}}(jQuery),popJSLibraryManager.register(popFullCalendar,["calendar"]),popJSLibraryManager.register(popFullCalendarControls,["controlCalendarPrev","controlCalendarNext"]);