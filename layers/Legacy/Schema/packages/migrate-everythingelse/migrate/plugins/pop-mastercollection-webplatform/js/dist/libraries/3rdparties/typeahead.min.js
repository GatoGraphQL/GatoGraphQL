"use strict";!function(e){window.popTypeahead={typeaheadSearchBtn:function(t){var a=this,n=t.pageSection,i=t.block;t.targets.click(function(){var t=e(this).closest(".pop-typeahead");a.executeTypeaheadSearch(n,i,t)})},typeaheadSearchInput:function(t){var a=this,n=t.pageSection,i=t.block;t.targets.keypress(function(t){if(13==event.which){event.preventDefault();var r=e(this).closest(".pop-typeahead");r.find('input[type="text"].tt-input').typeahead("close"),a.executeTypeaheadSearch(n,i,r)}})},fillTypeahead:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block;t.targets.each(function(){var t=e(this),p=t.data("urlparam");if(p){var o=popManager.getBlockTopLevelURL(r),c=getParam(p,o);if(c){var d=t.data("database-key");e.each(c,function(e,p){var o=popManager.getItemObject(n,d,p);a.selectTypeahead(n,i,r,t,o)}),popBootstrap.execOpenParentCollapse(t)}}})},selectDatum:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block;t.targets.click(function(t){t.preventDefault();var p=e(this),o=e(p.data("target")),c=p.data("objectid"),d=p.data("db-key"),l=popManager.getItemObject(n,d,c);a.selectTypeahead(n,i,r,o,l)})},selectableTypeahead:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block,p=t.targets;a.typeahead(n,i,r,p),p.each(function(){var t=e(this);a.validateMaxSelected(i,r,t),t.bind("typeahead:selected",function(t,p,o){var c=e(this);a.selectTypeahead(n,i,r,c,p)})})},fetchlinkTypeahead:function(t){var a=this,n=t.domain,i=t.pageSection,r=t.block,p=t.targets;a.typeahead(n,i,r,p),p.each(function(){e(this).bind("typeahead:selected",function(t,a,n){var i=e(this).closest(".pop-typeahead");popManager.click(a.url,"",i)})})},selectableTypeaheadTrigger:function(t){var a=this;t.pageSection,t.block;t.targets.on("close.bs.alert",function(){var t=e(this),n=t.closest(".pop-typeahead"),i=a.getElementsToDisable(n);i.attr("disabled",!1),i.removeClass("disabled");var r=t.children('input[type="hidden"]').val();n.triggerHandler("close",[t,r])})},selectTypeahead:function(e,t,a,n,i){var r=this,p=n.find('input[type="text"].tt-input');r.triggerSelect(e,t,a,n,i),p.typeahead("val","")},executeTypeaheadSearch:function(e,t,a){var n=a.find('input[type="text"].tt-input'),i=popManager.getQueryUrl(e,t);n.typeahead("val")&&(i=i.replace(M.JSPLACEHOLDER_QUERY,n.typeahead("val")),popManager.click(i,"",a))},getElementsToDisable:function(e){return e.children("div.pop-operation").find("a, button, input")},typeahead:function(t,a,n,i){var r=this;popManager.getPageSectionPage(n).one("destroy",function(){r.destroy(i)}),n.one("rerender",function(e){r.destroy(i)}),i.each(function(){var i=e(this),r=i.find('input[type="text"]'),p=popManager.getJsSettings(t,a,n,i),o=[];e.each(p["dataset-components"],function(e,i){var r=popManager.getJsSettings(t,a,n,i);o.push(r.dataset)}),e.each(o,function(e,t){var a=t.layout;t.template=popManager.getScriptTemplate(a);var n={};t.prefetch&&(n.url=t.prefetch,popJSLibraryManager.execute("typeaheadPrefetchURL",n),t.prefetch=n.url),t.remote&&(n.url=t.remote,popJSLibraryManager.execute("typeaheadRemoteURL",n),t.remote=n.url)});var c=[],d=[];e.each(o,function(t,a){var n=a.limit;o.length>1&&n>3&&(n=3);var i={datumTokenizer:function(t){var n=[];return e.each(a.tokenizerKeys,function(e,a){n=n.concat(Bloodhound.tokenizers.whitespace(t[a]))}),n},queryTokenizer:Bloodhound.tokenizers.whitespace};a.local&&(i.local=a.local),a.prefetch&&(i.prefetch={url:a.prefetch,thumbprint:a[M.KEYS_THUMBPRINT]}),a.remote&&(i.remote={url:a.remote,wildcard:M.JSPLACEHOLDER_QUERY});var r=new Bloodhound(i);c.push(r);var p;p=a.staticSuggestions?function(t,n){var i=[];e.each(a.staticSuggestions,function(a,n){var r={};e.each(n,function(e,a){"string"==typeof a&&(a=a.replace(M.JSPLACEHOLDER_QUERY,t)),r[e]=a}),i.push(r)}),n(i)}:r.ttAdapter(),d.push({source:p,name:a.name,display:a.valueKey,limit:n,templates:{suggestion:a.template,header:a.header,pending:a.pending,notFound:a.notFound}})}),e.each(c,function(e,t){t.initialize()}),1==d.length?r.typeahead({highlight:!0},d[0]):2==d.length?r.typeahead({highlight:!0},d[0],d[1]):3==d.length?r.typeahead({highlight:!0},d[0],d[1],d[2]):4==d.length&&r.typeahead({highlight:!0},d[0],d[1],d[2],d[3])})},triggerSelect:function(t,a,n,i,r){var p=this;if(r&&r.id&&0==i.find('input[type="hidden"][value="'+r.id+'"]').length){var o=popManager.getJsSettings(t,a,n,i),c=o["trigger-layout"],d=(popManager.getSettingsId(a),popManager.getSettingsId(n),{extendContext:e.extend({itemObject:r},o["datum-context"])});popJSRuntimeManager.setBlockURL(n);var l=popManager.getTemplateHtml(t,a,n,c,d);popManager.mergeHtml(l,i.find(".pop-box")),popManager.runJSMethods(t,a,n,c,"last"),popJSRuntimeManager.deleteBlockLastSessionIds(t,a,n,c),p.validateMaxSelected(a,n,i),i.triggerHandler("selected",[r])}},validateMaxSelected:function(e,t,a){var n=this;if(a.data("max-selected")&&a.find('input[type="hidden"]').length==a.data("max-selected")){var i=n.getElementsToDisable(a);i.attr("disabled","disabled"),i.addClass("disabled")}},removeSelected:function(e,t){e.find('input[type="hidden"][value="'+t+'"]').closest(".alert").alert("close")},destroy:function(e){e.find('input[type="text"].tt-input').typeahead("destroy")}}}(jQuery),popJSLibraryManager.register(popTypeahead,["selectableTypeahead","fillTypeahead","selectDatum","fetchlinkTypeahead","selectableTypeaheadTrigger","typeaheadSearchBtn","typeaheadSearchInput"]);