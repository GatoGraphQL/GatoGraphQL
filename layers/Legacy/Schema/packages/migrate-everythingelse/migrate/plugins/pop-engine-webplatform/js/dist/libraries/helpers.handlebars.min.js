"use strict";function getMultiLayoutKey(e,t){var r=M.MULTILAYOUT_KEYFIELDS[e]||[];if(!r.length)return"default";var n=[];return jQuery.each(r,function(e,r){n.push(t[r])}),n.join("-")}Handlebars.registerHelper("showmore",function(e,t){var r=t.hash.len||0;if(r>0&&e.length>r+100){var n=r,a='<a href="#" class="pop-showmore-more">'+M.STRING_MORE+"</a>",s='<a href="#" class="pop-showmore-less hidden">'+M.STRING_LESS+"</a>",i=!1,o=!0;if(e.length>n&&e.substr(r).indexOf("</p>")>-1&&(i=!0,o=!1,n=r+(e=e.substr(0,r)+'<span class="pop-showmore-more-full hidden">'+e.substr(r,e.substr(r).indexOf("</p>"))+"</span> "+a+e.substr(r+e.substr(r).indexOf("</p>"))).substr(r).indexOf("</p>")+"</p>".length),i||e.length>n){var h=e.substr(n),p=h.trim().length;if(i||p){var d='<span class="pop-showmore-more-teaser">'+e.substr(0,n)+"</span>"+(p?'<span class="pop-showmore-more-full hidden">'+h+"</span> ":" ")+(o?a:"")+s;return new Handlebars.SafeString(d)}}}return e}),Handlebars.registerHelper("ondate",function(e,t){return new Handlebars.SafeString(M.ONDATE.format(e))}),Handlebars.registerHelper("addParam",function(e,t,r,n){return jQuery.isArray(r)||(r=[r]),jQuery.each(r,function(r,n){e=add_query_arg(t,n,e)}),e}),Handlebars.registerHelper("destroyUrl",function(e,t){return new Handlebars.SafeString(popManager.getDestroyUrl(e))}),Handlebars.registerHelper("statusLabel",function(e,t){var r='<span class="label '+M.STATUS.class[e]+" label-"+e+'">'+M.STATUS.text[e]+"</span>";return new Handlebars.SafeString(r)}),Handlebars.registerHelper("labelize",function(e,t,r){var n="";if(e)for(var a=0;a<e.length;a++)n+='<span class="label '+t+" "+(M.LABELIZE_CLASSES[e[a]]?M.LABELIZE_CLASSES[e[a]]:"")+'">'+e[a]+"</span> ";return new Handlebars.SafeString(n)}),Handlebars.registerHelper("mod",function(e,t,r){if(arguments.length<3)throw new Error("Handlebars Helper equal needs 2 parameters");return(e+(r.hash.offset||0))%t==0?r.fn(this):r.inverse(this)}),Handlebars.registerHelper({eq:function(e,t){return e===t},or:function(e,t){return e||t}}),Handlebars.registerHelper("compare",function(e,t,r){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");var n=r.hash.operator||"==",a={eq:function(e,t){return e==t||e.toString()==t.toString()},"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},typeof:function(e,t){return typeof e==t},in:function(e,t){return t.indexOf(e)>=0},notin:function(e,t){return-1==t.indexOf(e)}};if(!a[n])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+n);return a[n](e,t)?r.fn(this):r.inverse(this)}),Handlebars.registerHelper("get",function(e,t,r){return void 0===e||void 0===e[t]?"":e[t]}),Handlebars.registerHelper("ifget",function(e,t,r){if(void 0===e)return"";var n=r.hash.context||this,a=!1;if(r.hash.method){var s=popJSLibraryManager.execute(r.hash.method,{domain:n.tls.domain,input:e[t]});jQuery.each(s,function(e,t){if(t)return a=!0,-1})}else a=e[t];return a?r.fn(this):r.inverse(this)}),Handlebars.registerHelper("withget",function(e,t,r){if(void 0===e||void 0===e[t])return"";var n=e[t];return"object"===jQuery.type(n)&&popManager.expandJSKeys(n),r.fn(n)}),Handlebars.registerHelper("iffirstload",function(e){var t=e.hash.context||this,r=e.hash.pssId||t.pss.pssId;return popManager.isFirstLoad(r)?e.fn(this):e.inverse(this)}),Handlebars.registerHelper("interceptAttr",function(e){var t=(e.hash.context||this)[M.JS_INTERCEPT]||{};return new Handlebars.SafeString((t[M.JS_TYPE]?' data-intercept="'+t[M.JS_TYPE]+'"':"")+(t.settings?' data-intercept-settings="'+t[M.JS_SETTINGS]+'"':"")+(t[M.JS_TARGET]?' target="'+t[M.JS_TARGET]+'"':"")+(t[M.JS_SKIPSTATEUPDATE]?' data-intercept-skipstateupdate="true"':"")+' style="display: none;"')}),Handlebars.registerHelper("generateId",function(e){var t=e.hash.context||this,r=e.hash.pssId||t.pss.pssId,n=e.hash.targetId||t.bs.bsId,a=e.hash.template||t[M.JS_TEMPLATE],s=e.hash.fixed||t[M.JS_FIXEDID],i=e.hash.idUnique||t[M.JS_ISIDUNIQUE],o=e.hash.group,h=e.fn(this),p=t.ignorePSRuntimeId,d=t.tls.domain,u=e.hash.addURL?t.tls.feedback[M.URLPARAM_URL]:"";u&&popJSRuntimeManager.setBlockURL(u);var l=popJSRuntimeManager.addTemplateId(d,r,n,a,h,o,s,i,p),S=[];return S.push('id="'+l+'"'),S.push('data-templateid="'+a+'"'),u&&(S.push("data-"+M.PARAMS_TOPLEVEL_URL+'="'+u+'"'),S.push("data-"+M.PARAMS_TOPLEVEL_DOMAIN+'="'+getDomain(u)+'"')),new Handlebars.SafeString(S.join(" "))}),Handlebars.registerHelper("lastGeneratedId",function(e){var t=e.hash.context||this,r=e.hash.pssId||t.pss.pssId,n=e.hash.targetId||t.bs.bsId,a=e.hash.template||t[M.JS_TEMPLATE],s=e.hash.domain||t.tls.domain,i=e.hash.group;return popJSRuntimeManager.getLastGeneratedId(s,r,n,a,i)}),Handlebars.registerHelper("applyLightTemplate",function(e,t){var r=t.hash.context||this,n=popManager.getHtml(e,r);return new Handlebars.SafeString(n)}),Handlebars.registerHelper("json",function(e){return JSON.stringify(e)}),Handlebars.registerHelper("enterModule",function(e,t){var r=t.hash.context||this,n=t.hash.template||r[M.JS_TEMPLATE],a=e.tls,s=e.pss,i=e.bs,o=e.itemObject,h=e.itemObjectDBKey,p=e.ignorePSRuntimeId,d=void 0!==t.hash.itemDBKey?t.hash.itemDBKey:e.itemDBKey,u={itemObject:o,itemObjectDBKey:h,itemDBKey:d,items:void 0!==t.hash.items?t.hash.items:e.items,tls:a,pss:s,bs:i,ignorePSRuntimeId:p},l=a.domain,S=s.pssId,m=s.psId,c=i.bsId,f=i.bId;jQuery.extend(r,popManager.getRuntimeConfiguration(l,S,c,n)),popManager.expandJSKeys(r);var g=t.hash.itemObjectId;"array"===jQuery.type(g)&&(g.length?g=g[0]:(g=null,o=null,u.itemObject=o)),t.hash.itemDBKey&&g?(d=t.hash.itemDBKey,o=popManager.getItemObject(l,d,g),u.itemObject=o,u.itemObjectDBKey=d,u.itemDBKey=d,u.items=[g]):t.hash.itemDBKey&&t.hash.items?(u.itemDBKey=t.hash.itemDBKey,u.items=t.hash.items):t.hash.subcomponent&&g?(d=i["db-keys"][M.JS_SUBCOMPONENTS][t.hash.subcomponent]["db-key"],o=popManager.getItemObject(l,d,g),u.itemObject=o,u.itemObjectDBKey=d,u.itemDBKey=d,u.items=[g]):t.hash.subcomponent&&t.hash.items?(d=i["db-keys"][M.JS_SUBCOMPONENTS][t.hash.subcomponent]["db-key"],u.itemDBKey=d,u.items=t.hash.items):t.hash.items?u.items=t.hash.items:t.hash.itemDBKey&&(u.itemDBKey=t.hash.itemDBKey,u.itemObject=null,u.itemObjectDBKey=null,u.items=null),u.items&&"array"!==jQuery.type(u.items)&&(u.items=[u.items]),t.hash["feedback-msg"]&&(u["feedback-msg"]=t.hash["feedback-msg"]);var b=[],y=[],E=[];r[M.JS_MODULEOPTIONS]&&(b=r[M.JS_MODULEOPTIONS][M.JS_OVERRIDEFROMITEMOBJECT]||[],y=r[M.JS_MODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[]),r[M.JS_RUNTIMEMODULEOPTIONS]&&(E=r[M.JS_RUNTIMEMODULEOPTIONS][M.JS_REPLACESTRFROMITEMOBJECT]||[]),b.length&&popManager.overrideFromItemObject(o,u,b);var H=y.concat(E);H.length&&popManager.replaceFromItemObject(l,S,c,n,o,u,H);var I=t.hash.parentContext||{};if(I){u["parent-context"]=I;for(var O=I;O["parent-context"];)O=O["parent-context"];u["root-context"]=O}jQuery.extend(r,u);var T=popManager.getHtml(n,r),v={response:T,context:r,templateName:n,domain:l,pssId:S,psId:m,bsId:c,bId:f};return popJSLibraryManager.execute("handlebarsHelperEnterModuleResponse",v),T=v.response,t.hash.unsafe?T:new Handlebars.SafeString(T)}),Handlebars.registerHelper("withLayout",function(e,t,r,n,a){var s=n.tls.domain,i=r[getMultiLayoutKey(e,popManager.getItemObject(s,e,t))];if(i||(i=r.default),!i)return"";var o=n[M.JS_MODULES][i];return jQuery.extend(o,{itemDBKey:e,itemObjectId:t}),popManager.expandJSKeys(o),a.fn(o)}),Handlebars.registerHelper("layoutLabel",function(e,t,r){var n=getMultiLayoutKey(e,t);return M.MULTILAYOUT_LABELS[n]||""}),Handlebars.registerHelper("withBlock",function(e,t,r){if(void 0!==e&&void 0!==e[M.JS_MODULES]&&void 0!==e[M.JS_MODULES][t])return e=e[M.JS_MODULES][t],popManager.expandJSKeys(e),r.fn(e)}),Handlebars.registerHelper("withModule",function(e,t,r){if(void 0!==e&&void 0!==e[M.JS_SETTINGSIDS]&&void 0!==e[M.JS_SETTINGSIDS][t]){var n=e[M.JS_SETTINGSIDS][t];if(void 0!==e[M.JS_MODULES]&&void 0!==e[M.JS_MODULES][n])return e=e[M.JS_MODULES][n],popManager.expandJSKeys(e),jQuery.extend(e,r.hash),r.fn(e)}}),Handlebars.registerHelper("withSublevel",function(e,t){var r=t.hash.context||this;return"object"===jQuery.type(r)&&popManager.expandJSKeys(r),t.fn(r[e])}),Handlebars.registerHelper("withItemObject",function(e,t,r){var n=(a=r.hash.context||this).tls.domain,a=popManager.getItemObject(n,e,t);return r.fn(a)});