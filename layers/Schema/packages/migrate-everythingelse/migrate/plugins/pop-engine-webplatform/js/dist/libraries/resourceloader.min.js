"use strict";function markJSResourceAsLoaded(e,o){popResourceLoader.markJSResourceAsLoaded(e,o)}function markResourceAsLoaded(e,o){popResourceLoader.markResourceAsLoaded(e,o)}!function(e){window.popResourceLoader={config:{},loading:[],"error-loading":[],"error-loading-times":{},"loading-urls":{},"loading-resources":{},loaded:[],"loaded-in-body":[],"loaded-by-domain":{},preFetchPageSection:function(o){var r=this,a=o.url,n=o.options;if(M.USECODESPLITTING)if(r.configFilesLoaded(a,n))r.loadResourcesForURL(a);else{var i=r.loadURLConfigFile(a);e(document).one("loaded-url:"+escape(i),function(e){r.loadResourcesForURL(a)})}},areResourcesLoaded:function(e){var o=this;M.USECODESPLITTING&&(e.loaded=o.areResourcesLoadedForURL(e.fetchUrl))},loadScriptOrStyle:function(e,o){e==M.RESOURCELOADER.TYPES.CSS?load_style(o):e==M.RESOURCELOADER.TYPES.JS&&load_script(o)},onRemoveLoadResource:function(o,r,a){var n=this,i=e("#"+o);popManager.getPageSectionPage(i).one("destroy",function(){n.loadScriptOrStyle(r,a)}),i.one("replace",function(){n.loadScriptOrStyle(r,a)})},includeResources:function(o,r,a,n){var i=this;if(!a)return"";var t=i.getConfigByDomain(o),d=[];return n&&(d=e(a).not(i["loaded-in-body"]).get(),a=e(a).not(i.loaded).get()),i.loaded=i.loaded.concat(a),i["loaded-in-body"]=i["loaded-in-body"].concat(d),(a=d).map(function(e){var o=t.sources[e],a='<script type="text/javascript">jQuery(document).ready( function($) { popResourceLoader.onRemoveLoadResource("{0}", "{1}", "{2}"); });<\/script>';if(t.types[M.RESOURCELOADER.TYPES.CSS].indexOf(e)>=0)return(n=a.format(r,M.RESOURCELOADER.TYPES.CSS,o))+(i='<link rel="stylesheet" href="{0}">'.format(o));if(t.types[M.RESOURCELOADER.TYPES.JS].indexOf(e)>=0){var n=a.format(r,M.RESOURCELOADER.TYPES.JS,o),i='<script type="text/javascript" src="{0}"><\/script>'.format(o);return n+i}return""}).join("")},markJSResourceAsLoaded:function(e,o){var r=this;if("ok"==o){var a=r["loading-urls"][e];popCodeSplitJSLibraryManager.assignLibrariesToResource(a)}r.markResourceAsLoaded(e,o)},markResourceAsLoaded:function(e,o){var r=this,a=r["loading-urls"][e];if("ok"==o)r.loaded.push(a),r["loaded-in-body"].push(a);else if("error"==o){r["error-loading"].push(a);var n=r["error-loading-times"][a]||0;r["error-loading-times"][a]=n+1}r.loading.splice(r.loading.indexOf(a),1),delete r["loading-urls"][e]},loadURLConfigFile:function(e){var o=this.getConfigFile(e);return load_script(o),o},configFilesLoaded:function(e,o){var r=this,a=r.getConfig(e);if(a.loaded)return!0;var n=r.getPropertiesForURL(e),i=n.hierarchy,t=n.path;if(["page","single"].indexOf(i)>=0&&a["loaded-paths"][i]&&a["loaded-paths"][i].indexOf(t)>=0)return!0;var d=r.getConfigFile(e);return a["loaded-files"].indexOf(d)>=0},getConfigFile:function(e){var o=this,r=o.getConfig(e),a=o.getPropertiesForURL(e),n=a.hierarchy,i=a.format;return r["configfile-urlplaceholder"].format(n,i)},getPropertiesForURL:function(e){var o=this,r=popUtils.getPath(e);return{hierarchy:o.getHierarchy(e),format:getParam(M.URLPARAM_FORMAT,e)||M.VALUES_DEFAULT,path:r}},getConfigByDomain:function(e){var o=this,r=o.config[e];return r||e==M.HOME_DOMAIN||(r=o.config[M.HOME_DOMAIN]),r||{}},getConfig:function(e){var o=this,r=getDomain(e);return o.getConfigByDomain(r)},getHierarchy:function(e){var o=this.getConfig(e),r=popUtils.getPath(e);return r?r.startsWith(o.paths.author)&&r!=o.paths.author?"author":r.startsWith(o.paths.tag)&&r!=o.paths.tag?"tag":-1===o.paths.single.indexOf(r)&&o.paths.single.some(function(e){return r.startsWith(e)&&r!=e})?"single":"page":"home"},getResourcesDB:function(e){var o=this,r=o.getConfig(e);if(!r||!r.resources)return{};var a=o.getHierarchy(e),n=popUtils.getPath(e),i=r.resources[a];if(!i)return{};"single"==a?i=i[r.paths.single.filter(function(e){return n.startsWith(e)&&n!=e})[0]]:"page"==a&&(i=i[n]);var t={url:e,path:n,config:r,resourcesDB:i};return popJSLibraryManager.execute("loadResourcesDB",t),(i=t.resourcesDB)||{}},getURLComponents:function(e){var o=[],r=getParam(M.URLPARAM_TARGET,e)||M.URLPARAM_TARGET_MAIN,a=getParam(M.URLPARAM_FORMAT,e)||M.VALUES_DEFAULT,n=getParam(M.URLPARAM_TAB,e)||"";return a&&o.push(M.CODESPLITTING.PREFIXES.FORMAT+a),n&&o.push(M.CODESPLITTING.PREFIXES.TAB+n),r&&o.push(M.CODESPLITTING.PREFIXES.TARGET+r),{params:o,target:r,format:a,tab:n,key:o.join(M.SEPARATOR_RESOURCELOADER)}},initLoadedByDomain:function(e){var o=this;o["loaded-by-domain"][e]||(o["loaded-by-domain"][e]={bundles:[],"bundle-groups":[]})},loadResourcesForURL:function(o){var r=this,a=r.getConfig(o),n=r.getResourcesDB(o),i=r.getURLComponents(o),t=a.keys[i.key];if(t&&n[t]){var d=getDomain(o);r.initLoadedByDomain(d);var s=n[t];e.each(s,function(n,i){if(-1==r["loaded-by-domain"][d]["bundle-groups"].indexOf(i)){var t=a["bundle-groups"][i]||[];t=e(t).not(r["loaded-by-domain"][d].bundles).get(),e.each(t,function(n,i){if(-1==r["loaded-by-domain"][d].bundles.indexOf(i)){var t=a.bundles[i];t=e(t).not(r.loaded).get(),t=e(t).not(r.loading).get(),e.each(t,function(e,n){r.loadResource(o,a,n)})}})}})}else i.target!=M.URLPARAM_TARGET_MAIN&&(o=removeQueryFields(o,[M.URLPARAM_TARGET]),r.loadResourcesForURL(o))},loadResource:function(e,o,r){var a=this;a["loading-resources"][e]=a["loading-resources"][e]||[],-1==a["loading-resources"][e].indexOf(r)&&a["loading-resources"][e].push(r),a.loading.push(r);var n=a["error-loading"].indexOf(r);n>=0&&a["error-loading"].splice(n,1);var i=o.sources[r];if(a["loading-urls"][i]=r,o.types[M.RESOURCELOADER.TYPES.JS].indexOf(r)>=0){var t=o["ordered-load-resources"].indexOf(r)>=0;load_script(i,markJSResourceAsLoaded,t)}else o.types[M.RESOURCELOADER.TYPES.CSS].indexOf(r)>=0&&load_style(i,markResourceAsLoaded)},areResourcesLoadedForURL:function(o){var r=this,a=r.getConfig(o),n=r.getResourcesDB(o),i=r.getURLComponents(o),t=a.keys[i.key];if(t&&n[t]){var d=getDomain(o);r.initLoadedByDomain(d);var s=n[t];s=e(s).not(r["loaded-by-domain"][d]["bundle-groups"]).get();var u=!0;if(e.each(s,function(n,i){var t=a["bundle-groups"][i]||[];t=e(t).not(r["loaded-by-domain"][d].bundles).get();var s=!0;e.each(t,function(n,i){var t=a.bundles[i];t=e(t).not(r.loaded).get();var u=!0;e.each(t,function(e,n){if(r["error-loading"].indexOf(n)>=0&&(r["error-loading-times"][n]>=3?r.loaded.push(n):r.loadResource(o,a,n)),-1==r.loaded.indexOf(n)){u=!1;var i=a.sources[n];r["loading-urls"][i]||r.loadResource(o,a,n)}}),u?r["loaded-by-domain"][d].bundles.push(i):s=!1}),s?r["loaded-by-domain"][d]["bundle-groups"].push(i):u=!1}),u){var l=r["loading-resources"][o];if(l&&l.length){delete r["loading-resources"][o];var c=[];if(e.each(l,function(e,o){c=c.concat(popCodeSplitJSLibraryManager.getLibraries(o))}),c.length){var g={domain:M.HOME_DOMAIN,codeSplitLibraries:c};popJSLibraryManager.execute("documentInitializedIndependent",g)}}}return u}return i.target==M.URLPARAM_TARGET_MAIN||(o=removeQueryFields(o,[M.URLPARAM_TARGET]),r.areResourcesLoadedForURL(o))}}}(jQuery),popJSLibraryManager.register(popResourceLoader,["preFetchPageSection","areResourcesLoaded"]);