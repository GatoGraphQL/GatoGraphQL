"use strict";!function(e){window.popReplicate={replicateTopLevel:function(t){var a=this,n=t.pageSection;t.targets.each(function(){var t=e(this),i=t.data("replicate-type");i==M.REPLICATETYPES.MULTIPLE?a.replicateMultipleTopLevel(n,t):i==M.REPLICATETYPES.SINGLE&&a.replicateSingleTopLevel(n,t)})},replicatePageSection:function(t){var a=this,n=t.pageSection;t.targets.each(function(){var t=e(this),i=t.data("replicate-type");i==M.REPLICATETYPES.MULTIPLE?a.replicateMultiplePageSection(n,t):i==M.REPLICATETYPES.SINGLE&&a.replicateSinglePageSection(n,t)})},replicateMultipleTopLevel:function(t,a){var n=this;a.click(function(a){a.preventDefault();var i=e(this),r=i.data("unique-url")||!1;n.execReplicateTopLevel(t,i,!0,r)})},replicateSingleTopLevel:function(t,a){var n=this;a.one("click",function(a){a.preventDefault();var i=e(this);n.execReplicateTopLevel(t,i,!1,!1)})},execReplicateTopLevel:function(t,a,n,i){var r=a.data("original-url"),p=getDomain(r),c=(popManager.getMemory(p),a.data("intercept-url")),o=popManager.getFrameTarget(t),l=popManager.getReplicableMemory(c,o),g=popManager.getTopLevelFeedback(p);e.each(l.feedback.toplevel,function(t,a){"array"==e.type(a)&&0==a.length||("object"==e.type(a)?(g[t]||(g[t]={}),e.extend(g[t],a)):g[t]=a)}),n&&(i&&r.indexOf("#")>-1?g[M.UNIQUEID]=r.substr(r.indexOf("#")+1):(popManager.generateUniqueId(p),i&&(r=popManager.addUniqueId(r))));var u=a.data("title");g[M.URLPARAM_TITLE]=u,g[M.URLPARAM_URL]=r,popManager.maybeUpdateDocument(p,t)},replicateMultiplePageSection:function(t,a){var n=this;a.click(function(a){a.preventDefault();var i=e(this);n.execReplicatePageSection(t,i)})},replicateSinglePageSection:function(t,a){var n=this;a.one("click",function(a){a.preventDefault();var i=e(this);n.execReplicatePageSection(t,i)})},execReplicatePageSection:function(t,a){a.data("block-settingsid"),popManager.getSettingsId(t);var n=a.data("templateid"),i=a.data("intercept-url"),r=getDomain(i),p=popManager.getMemory(r),c=popManager.getFrameTarget(t),o=popManager.getReplicableMemory(i,c);e.extend(p.feedback.pagesection,o.feedback.pagesection),e.each(o.feedback.block,function(t,a){e.extend(p.feedback.block[t],a),e.extend(p.dataset[t],o.dataset[t]),e.extend(p["query-state"].general[t],o["query-state"].general[t]),e.extend(p["query-state"].domain[t],o["query-state"].domain[t])});var l=popManager.getTopLevelFeedback(r),g=popManager.getPageSectionFeedback(r,t),u=popManager.getPageSectionConfiguration(r,t);g["intercept-urls"][n]||(g["intercept-urls"][n]={}),g["intercept-urls"][n][n]=l[M.URLPARAM_URL],u[M.JS_TEMPLATE]=n;var d={};a.next(".pop-interceptor-blocksettingsids").children().each(function(){var t=e(this),a=t.data("value");a=t.data("value")?[t.data("value")]:[],d[t.data("key")]=a}),u[M.JS_BLOCKSETTINGSIDS]=d,popManager.initPageSectionSettings(r,t,u);var s={"js-args":{relatedTarget:a},url:l[M.URLPARAM_URL]};popJSRuntimeManager.setPageSectionURL(l[M.URLPARAM_URL]),popManager.renderPageSection(r,t,null,s)}}}(jQuery),popJSLibraryManager.register(popReplicate,["replicateTopLevel","replicatePageSection"]);